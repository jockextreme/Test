<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Most Watched</title>
    <style>
        :root {
            --primary-dark: #0a192f;
            --secondary-dark: #172a45;
            --accent: #64ffda;
            --text-light: #ccd6f6;
            --spacing-base: 16px;
            --border-radius: 12px;
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .most-watched {
            padding: 2rem;
            background: var(--secondary-dark);
            border-radius: var(--border-radius);
            margin: 2rem;
        }

        .most-watched-title {
            color: var(--accent);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .most-watched-list {
            display: grid;
            gap: 1rem;
        }

        .watched-item {
            background: var(--primary-dark);
            padding: 1rem;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform var(--transition);
        }

        .watched-item:hover {
            transform: translateX(10px);
        }

        .views-count {
            background: rgba(100,255,218,0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="most-watched">
        <h2 class="most-watched-title">
            <i class="fas fa-fire"></i>
            Trending Now
        </h2>
        <div class="most-watched-list" id="mostWatchedList"></div>
    </div>

    <script>
        class MostWatched {
            static STORAGE_KEY = 'mostWatchedData';
            
            static init() {
                this.ensureStorage();
                this.renderList();
                this.setupDemoButtons(); // Remove in production
            }

            static ensureStorage() {
                if (!localStorage.getItem(this.STORAGE_KEY)) {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify({}));
                }
            }

            static trackView(videoId, title) {
                const data = this.getData();
                
                if (!data[videoId]) {
                    data[videoId] = {
                        title,
                        views: 0,
                        lastViewed: new Date().toISOString()
                    };
                }

                data[videoId].views++;
                data[videoId].lastViewed = new Date().toISOString();
                
                this.saveData(data);
                this.renderList();
            }

            static getData() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEY));
            }

            static saveData(data) {
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
            }

            static renderList() {
                const container = document.getElementById('mostWatchedList');
                const data = this.getData();
                
                const sortedItems = Object.entries(data)
                    .sort((a, b) => b[1].views - a[1].views)
                    .slice(0, 5);

                container.innerHTML = sortedItems.map(([id, item]) => `
                    <div class="watched-item">
                        <span>${item.title}</span>
                        <div class="views-count">
                            <i class="fas fa-eye"></i>
                            ${item.views}
                        </div>
                    </div>
                `).join('');
            }

            // Demo setup - remove in production
            static setupDemoButtons() {
                const demoVideos = [
                    { id: 'video1', title: 'Cultural Analysis: Part 1' },
                    { id: 'video2', title: 'Historical Documentation' },
                    { id: 'video3', title: 'Social Patterns Study' }
                ];

                demoVideos.forEach(video => {
                    const btn = document.createElement('button');
                    btn.textContent = `Play ${video.title}`;
                    btn.style.margin = '0.5rem';
                    btn.onclick = () => this.trackView(video.id, video.title);
                    document.body.appendChild(btn);
                });
            }
        }

        // Initialize on load
        MostWatched.init();
    </script>
</body>
</html>
